\addcontentsline{toc}{chapter}{\numberline{}Appendix}
\chapter*{Appendix}
\section*{Plot Data}
\begin{verbatim}
| nr | step                        |
|----+-----------------------------|
|  1 | push new version            |
|  2 | ci pulls code               |
|  3 | build                       |
|  4 | save container image(s)     |
|  5 | run tests                   |
|  6 | deploy                      |
|  7 | pull infrastructure code    |
|  8 | modify resource definitions |
|  9 | apply to production cluster |
| 10 | pull container image(s)     |
| 11 | send metrics                |
| 12 | trigger rollback            |

| plot     | exec |   steps | timestamp           | secs |
|----------+------+---------+---------------------+------|
|----------+------+---------+---------------------+------|
| deploy   |   1. |     6-8 | 2017-12-29 10:45:47 |   11 |
| din      |      |       9 | 2017-12-29 10:45:58 |    1 |
|          |      | running | 2017-12-29 10:45:59 |      |
|          |   2. |     6-8 | 2017-12-29 10:46:30 |    8 |
|          |      |       9 | 2017-12-29 10:46:38 |    1 |
|          |      | running | 2017-12-29 10:46:39 |      |
|          |   3. |     6-8 | 2017-12-29 10:47:02 |    9 |
|          |      |       9 | 2017-12-29 10:47:11 |    1 |
|          |      | running | 2017-12-29 10:47:12 |      |
|----------+------+---------+---------------------+------|
| deploy   |   1. |     6-8 | 2018-01-06 15:11:02 |   36 |
| gapfish  |      |       9 | 2018-01-06 15:11:38 |   70 |
|          |      | running | 2018-01-06 15:12:48 |      |
|          |   2. |     6-8 | 2018-01-06 15:14:50 |   20 |
|          |      |       9 | 2018-01-06 15:15:10 |   45 |
|          |      | running | 2018-01-06 15:15:55 |      |
|          |   3. |     6-8 | 2018-01-06 15:18:29 |   18 |
|          |      |       9 | 2018-01-06 15:18:47 |   75 |
|          |      | running | 2018-01-06 15:20:02 |      |
|----------+------+---------+---------------------+------|
| rollback |   1. |  12,7-8 | 2018-01-04 15:44:29 |    4 |
| din      |      |       9 | 2018-01-04 15:44:33 |    1 |
|          |      | running | 2018-01-04 15:44:34 |      |
|          |   2. |  12,7-8 | 2018-01-04 16:10:24 |    3 |
|          |      |       9 | 2018-01-04 16:10:27 |    1 |
|          |      | running | 2018-01-04 16:10:28 |      |
|          |   3. |  12,7-8 | 2018-01-04 16:19:39 |    3 |
|          |      |       9 | 2018-01-04 16:19:42 |    1 |
|          |      | running | 2018-01-04 16:19:43 |      |
|----------+------+---------+---------------------+------|
| rollback |   1. |  12,7-8 | 2018-01-06 15:24:19 |   48 |
| gapfish  |      |       9 | 2018-01-06 15:25:07 |   15 |
|          |      | running | 2018-01-06 15:25:22 |      |
|          |   2. |  12,7-8 | 2018-01-06 15:27:46 |   49 |
|          |      |       9 | 2018-01-06 15:28:35 |   14 |
|          |      | running | 2018-01-06 15:28:49 |      |
|          |   3. |  12,7-8 | 2018-01-06 15:30:52 |   48 |
|          |      |       9 | 2018-01-06 15:31:40 |   15 |
|          |      | running | 2018-01-06 15:31:55 |      |
|----------+------+---------+---------------------+------|
| metric   |   1. |      11 | 2018-01-04 15:42:20 |  129 |
| compar-  |      |      12 | 2018-01-04 15:44:29 |      |
| ison     |   2. |      11 | 2018-01-04 16:07:19 |  185 |
| din      |      |      12 | 2018-01-04 16:10:24 |      |
|          |   3. |      11 | 2018-01-04 16:12:59 |  400 |
|          |      |      12 | 2018-01-04 16:19:39 |      |
|----------+------+---------+---------------------+------|
| whole    |   1. |     1-2 | 2018-01-06 15:05:54 |    4 |
| pipeline |      |       3 | 2018-01-06 15:05:58 |  237 |
| gapfish  |      |       4 | 2018-01-06 15:09:55 |   67 |
| (build   |      |     6-8 | 2018-01-06 15:11:02 |   36 |
| step (5) |      |       9 | 2018-01-06 15:11:38 |   70 |
| skipped) |      | running | 2018-01-06 15:12:48 |      |
|          |   2. |     1-2 | 2018-01-06 15:13:03 |    6 |
|          |      |       3 | 2018-01-06 15:13:09 |   94 |
|          |      |       4 | 2018-01-06 15:14:43 |    7 |
|          |      |     6-8 | 2018-01-06 15:14:50 |   20 |
|          |      |       9 | 2018-01-06 15:15:10 |   45 |
|          |      | running | 2018-01-06 15:15:55 |      |
|          |   3. |     1-2 | 2018-01-06 15:16:50 |    4 |
|          |      |       3 | 2018-01-06 15:16:54 |   87 |
|          |      |       4 | 2018-01-06 15:18:21 |    8 |
|          |      |     6-8 | 2018-01-06 15:18:29 |   18 |
|          |      |       9 | 2018-01-06 15:18:47 |   75 |
|          |      | running | 2018-01-06 15:20:02 |      |

## 200 diffs
### raw
```
abs( 1 - ( avg:stage.apache.GET.200.count{*}.as_rate().rollup(sum, 30) / ( 2 * avg:stage.apache.canary.GET.200.count{*}.as_rate().rollup(sum, 30) ) ) )
```
### better readable
```
ratio = apache_GET_200_count.rollup(sum, 30) / (2 * apache_canary_GET_200.rollup(sum, 30) )
threshold = 3
abs(1 - ratio) > 3
```
\end{verbatim}
