\documentclass[runningheads,a4paper]{llncs}

%cmap has to be loaded before any font package (such as cfr-lm)
\usepackage{cmap}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\graphicspath{{./figures/}}

%Even though `american`, `english` and `USenglish` are synonyms for babel package (according to https://tex.stackexchange.com/questions/12775/babel-english-american-usenglish), the llncs document class is prepared to avoid the overriding of certain names (such as "Abstract." -> "Abstract" or "Fig." -> "Figure") when using `english`, but not when using the other 2.
%english has to go last to set it as default language
\usepackage[ngerman,english]{babel}
%Hint by http://tex.stackexchange.com/a/321066/9075 -> enable "= as dashes
\addto\extrasenglish{\languageshorthands{ngerman}\useshorthands{"}}

%better font, similar to the default springer font
%cfr-lm is preferred over lmodern. Reasoning at http://tex.stackexchange.com/a/247543/9075
\usepackage[%
rm={oldstyle=false,proportional=true},%
sf={oldstyle=false,proportional=true},%
tt={oldstyle=false,proportional=true,variable=true},%
qt=false%
]{cfr-lm}
%
%if more space is needed, exchange cfr-lm by mathptmx
%\usepackage{mathptmx}

%for demonstration purposes only
\usepackage[math]{blindtext}

%Sorts the citations in the brackets
%It also allows \cite{refa, refb}. Otherwise, the document does not compile.
%  Error message: "White space in argument"
\usepackage{cite}


%% If you need packages for other papers,
%% START COPYING HERE
%% COPY ALSO cmap and fontenc from lines 10 to 12

%extended enumerate, such as \begin{compactenum}
\usepackage{paralist}

%put figures inside a text
%\usepackage{picins}
%use
%\piccaptioninside
%\piccaption{...}
%\parpic[r]{\includegraphics ...}
%Text...

%for easy quotations: \enquote{text}
\usepackage{csquotes}

%enable margin kerning
\usepackage{microtype}

%tweak \url{...}
\usepackage{url}
%\urlstyle{same}
%improve wrapping of URLs - hint by http://tex.stackexchange.com/a/10419/9075
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother
%nicer // - solution by http://tex.stackexchange.com/a/98470/9075
%DO NOT ACTIVATE -> prevents line breaks
%\makeatletter
%\def\Url@twoslashes{\mathchar`\/\@ifnextchar/{\kern-.2em}{}}
%\g@addto@macro\UrlSpecials{\do\/{\Url@twoslashes}}
%\makeatother

%diagonal lines in a table - http://tex.stackexchange.com/questions/17745/diagonal-lines-in-table-cell
%slashbox is not available in texlive (due to licensing) and also gives bad results. This, we use diagbox
%\usepackage{diagbox}

%required for pdfcomment later
\usepackage{xcolor}


%enable nice comments
%this also loads hyperref
\usepackage{pdfcomment}
%enable hyperref without colors and without bookmarks
\hypersetup{hidelinks,
   colorlinks=true,
   allcolors=black,
   pdfstartview=Fit,
   breaklinks=true}
%enables correct jumping to figures when referencing
\usepackage[all]{hypcap}

\newcommand{\commentontext}[2]{\colorbox{yellow!60}{#1}\pdfcomment[color={0.234 0.867 0.211},hoffset=-6pt,voffset=10pt,opacity=0.5]{#2}}
\newcommand{\commentatside}[1]{\pdfcomment[color={0.045 0.278 0.643},icon=Note]{#1}}

%compatibality with packages todo, easy-todo, todonotes
\newcommand{\todo}[1]{\commentatside{#1}}
%compatiblity with package fixmetodonotes
\newcommand{\TODO}[1]{\commentatside{#1}}

%enable \cref{...} and \Cref{...} instead of \ref: Type of reference included in the link
\usepackage[capitalise,nameinlink]{cleveref}
%Nice formats for \cref
\crefname{section}{Sect.}{Sect.}
\Crefname{section}{Section}{Sections}

\usepackage{xspace}
%\newcommand{\eg}{e.\,g.\xspace}
%\newcommand{\ie}{i.\,e.\xspace}
\newcommand{\eg}{e.\,g.,\ }
\newcommand{\ie}{i.\,e.,\ }

%introduce \powerset - hint by http://matheplanet.com/matheplanet/nuke/html/viewtopic.php?topic=136492&post_id=997377
\DeclareFontFamily{U}{MnSymbolC}{}
\DeclareSymbolFont{MnSyC}{U}{MnSymbolC}{m}{n}
\DeclareFontShape{U}{MnSymbolC}{m}{n}{
    <-6>  MnSymbolC5
   <6-7>  MnSymbolC6
   <7-8>  MnSymbolC7
   <8-9>  MnSymbolC8
   <9-10> MnSymbolC9
  <10-12> MnSymbolC10
  <12->   MnSymbolC12%
}{}
\DeclareMathSymbol{\powerset}{\mathord}{MnSyC}{180}

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}

%% END COPYING HERE


\begin{document}

\title{Testing in Production for a fewer Risk.}
%If Title is too long, use \titlerunning
%\titlerunning{Short Title}

%Single insitute
\author{Sebastian Schasse}
%If there are too many authors, use \authorrunning
%\authorrunning{First Author et al.}
\institute{
  \email{schasse@mail.tu-berlin.de}\\
  Technische Universit√§t Berlin
}

%Multiple insitutes
%Currently disabled
%
\iffalse
%Multiple institutes are typeset as follows:
\author{Firstname Lastname\inst{1} \and Firstname Lastname\inst{2} }
%If there are too many authors, use \authorrunning
%\authorrunning{First Author et al.}

\institute{
Insitute 1\\
\email{...}\and
Insitute 2\\
\email{...}
}
\fi

\maketitle

\begin{abstract}
Abstract goes here
\end{abstract}

\begin{keywords}
keyword1, keyword2
\end{keywords}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Kubernetes}

Kubernetes is a cluster management system, which supports runtime features for high availability applications, creates a high utilization of shared resources and makes developers happy with deployment automation, isolated environments and debugging features~\cite{borg_kubernetes}.

\section{Containers}

Containers are a virtualization of an operating system with its software. That means you as a developer get an isolated environment which internally looks like an operating system, with which you can install and run software. Kubernetes uses Docker\footnote{Docker \url{https://www.docker.com/}} as a container runtime. You can define the operating system and the installed software via the so called Dockerfile\footnote{Dockerfile reference \url{https://docs.docker.com/engine/reference/builder/}} and then build an image out of the Dockerfile with \texttt{docker build}, as shown in figure~\ref{fig:containers}. It is then possible to start the image and instantiate it to a container with \texttt{docker run}\footnote{Docker run reference \url{https://docs.docker.com/engine/reference/run/}}.

As described above, the instantiated container internally looks like an operating system. That means that you also have a network interface available for not just sending messages, but also receiving messages from and to another container or machine. This gives the possibility to build distributed systems with containers.

\section{Deployments in Kubernetes}

Imagine a typical 3-tier-webapplication with multiple clients, 3 webservers and a master slave database replicaset consisting of 3 instances as shown in figure~\ref{fig:webapp}. Thus you have 6 containers which could be deployed to Kubernetes: each instance of the 3 webservers would be a container and each instance of the 3 databaseservers would be a container. Traffic from clients will be distributed via an external loadbalancer to the webservers for evenly distributed load on the webservers. The webservers communicate with the database and the databaseservers communicate with each other for the purpose of replication, just like regular machines.

Since we now have containers defined, we just need to get them into the Kubernetes cluster. How do we achieve that? We provide Kubernetes with configuration files! With the help of diagram~\ref{fig:kubernetes_cluster} we examine what happens when you push a configuration to Kubernetes to deploy your system. You can define a system like the mentioned 3-tier-webapplication in Kubernetes configuration files\footnote{Examplary Kubernetes configuration of a 3-tier-webapp \url{https://github.com/kubernetes/kubernetes/tree/release-1.2/examples/guestbook-go/}}. Thus there is a command line interface \texttt{kubectl}. With which you can (1) push the system configuration to the Kubernetes and Kubernetes will take care of the rest of the deployment. The Kubernetes \emph{master} is the managing machine and delegates the start and stop of containers to minions. Kubernetes \emph{minions} are machines, which execute the work by actually running and hosting the containers. The master receives the system configuration, which was pushed to Kubernetes, and then decides on which minion the container will run. A minion or formerly called worker has typically little logic, but has resources to run multiple containers. The decision of the master on which minion a container is supposed to run, is based on several rules. The master will p.e. take in account how much the minion is utilized, if the minion has enough resources for the container you want to deploy and other rules which are defined in the mentioned configuration files, p.e. there can be some rule like a database container must not run on the same machine as another database container. After the master has decided on which minion to deploy the container, it sends the minion a message (2) responsible for starting the container. So the minion needs to fetch (3) the container image from a \emph{image repository}\footnote{Docker hub image repository \url{https://hub.docker.com/}}. Now the minion needs to start (4) the container and the container begins to do its work.

The configuration files\footnote{Kubernetes configuration reference \url{http://kubernetes.io/docs/user-guide/configuring-containers/}} which will be pushed to the master via \texttt{kubectl} and the master itself are designed to be declarative. This means you don't define what needs to be done in order to have your system running, you define what the system should look like. Practically you don't define to start webserver 1, start webserver 2, start webserver 3. Instead the definition will be like this: there are 3 webservers running. This has the advantage that the operations with \texttt{kubectl} are idempotent. Likewise the master is designed in this way. The master knows there should be 3 webservers running. So the master monitors the minions and has the information of how many containers of one kind are recently running. And if the master sees just 2 webserver containers running in total, but there are supposed to be 3, the master will figure out where to start the third one.

Kubernetes has even more abstractions than just simple containers. It introduces not only containers, but labels, pods, replication controllers and services as sophisticated concepts to define a distributed and high available system. The Kubernetes documentation\footnote{Kubernetes 201 \url{http://kubernetes.io/docs/user-guide/walkthrough/k8s201/}} itself explains very well what these are and how to use them.

\section{From Blue-Green Deployments to Phoenix Replacement}

The approach of blue green deployment~\cite[find page]{continuous_delivery} involves two environments. One is the environment which serves production traffic, the other environment is in standby. You deploy to the other environment the new version. You then switch routing from the environment, which runs the old version, to the environment with the new version.

This has the major disadvantage that it is a waste of resources. Just one environment doing work with serving production traffic as the other environment is just idling. Even if you use the idling environment as a staging it would be oversized and still wasting
resources.

In times of dynamic resource allocation, automation and virtual machines, it became easy to automatically spawn new servers. In for a deploy of a new version you would not change the servers, but automatically create new ones with the version to deploy, then switch the traffic from the old servers to the new servers, and in the end just destroy the old servers. This procedure is called phoenix replacement~\cite[p. 283]{infra_as_code}.

\section{Canary Releases}

Canary releasing~\cite[find page]{continuous_delivery} is a way to test new versions of the application in production. But testing in production is risky, because when there is an error which leads to a defect or failure the users will get affected. And this costs money in any way.

There comes canary releasing into play. A single canary can't do much harm and it's not a big catastrophe if the small canary is malicious. Let me explain it at the example of a typically scaled web application. Usually you do not have just a single web server, but multiple servers. So when releasing in the canary style, you change just a small proportion of the twenty webservers to the new version. Now two versions of the webservers are running at the same time.

Usually you want exactly the same version of webservers in production with the exact same configuration. This makes systems easier to debug in case of an error. The maximum count of different versions during canary releasing is two. But why go for two different versions in production with the canary releasing technique, when it makes debugging in general harder.

It's because with canary releasing you can achieve different goals. The first one is truly when an error occurs. Just because less users are affected by the error. The majority of webservers is still in the old version, so just a small portion of all the users have a poor experience with the erroneous small canary version fraction.

In case of success, when everything works as expected, it is proven that there is less risk of errors, even under real production conditions.

canary releasing with features

canary releasing when doing refactorings.

\section{Deployments}

The extend to the canary releasing technique is a rolling update. It unifies phoenix replacement and canary releasing and extends it to a full deployment. You start with one server in the new version and spawn it automatically. Now it becomes part of the whole pool of servers and serves traffic as the server is ready. Now two different versions are serving traffic, just like with a canary release. But after the first step the deployment goes on and then destroys a server instance in the old version as you would do in the phoenix replacement. Then the procedure will be done multiple times until all servers of the old version are replaced by the new version.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{splncs03}
\bibliography{thesis}

All links were last followed on October 5, 2014.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
